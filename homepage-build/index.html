<head><title>Telescope</title><style>@font-face {
  font-family: "IBMPlexMono SemiBold";
  src: url("IBMPlexMono-SemiBold.ttf");
}

@font-face {
  font-family: "OpenSans";
  src: url("OpenSans-Regular.ttf");
}

@font-face {
  font-family: "OpenSans";
  src: url("OpenSans-Bold.ttf");
  font-weight: bold;
}

body {
  color: #0b0b0b;
  display: flex;
  font-family: "OpenSans", sans-serif;
  font-size: 18px;
  height: 100vh;
  margin: 0;
}

.sidebar {
  background-color: #5e5086;
  color: #fbfbfb;
  display: flex;
  flex: 0 1 auto;
  flex-direction: column;
  font-size: 14px;
  height: 100%;
  line-height: 0.6;
  overflow-y: auto;
  padding-left: 1em;
  padding-right: 1em;
}

pre.sourceCode {
  background-color: #f0f0f0;
  border-radius: 5px;
  overflow: auto;
  padding: 10px;
}

@media (max-width:600px) {
  .sidebar {
    display: none;
  }
}

.content {
  background-color: #fbfbfb;
  display: flex;
  flex: 1;
  justify-content: center;
  line-height: 1.6;
  overflow-y: scroll;
  padding: 1em;
}

.content > div > *:last-child {
  margin-bottom: 1em;
}

.content > div {
  max-width: min(700px, 100%);
}

.content img {
  max-width: min(700px, 100%);
}

.content p a,
.content li a {
  color: #005cc5;
  text-decoration: none;
}

.content p a:hover,
.content li a:hover {
  text-decoration: underline;
}

.headers {
  flex: 1;
  padding-top: 1em;
}

.headers h4 {
  padding-left: 1em;
}

.headers h3,
.headers h4 {
  font-weight: normal;
}

.headers a {
  color: inherit;
  text-decoration: none;
}

.headers a:hover {
  text-decoration: underline;
}

.github {
  text-align: center;
}

.github img {
  max-width: 6em;
  padding-bottom: 1em;
}

code {
  font-family: "IBMPlexMono SemiBold";
  font-size: 14px;
}

code .co { color: #005cc5; }
code .dt { color: #6f42c1; }
code .fu { color: #0b0b0b; }
code .kw { color: #d73a49; }
code .ot { color: #d73a49; }
code .op { color: #d73a49; }
code .st { color: #22863a; }
</style><meta content="width=device-width, initial-scale=1" name="viewport" /></head><body><div class="sidebar"><div class="headers"><a href="#Telescope"><h3>Telescope</h3></a><a href="#Introduction"><h4>Introduction</h4></a><a href="#Getting Started"><h4>Getting Started</h4></a><a href="#Contributing"><h4>Contributing</h4></a><a href="#About Telescope"><h3>About Telescope</h3></a><a href="#Application Architecture"><h4>Application Architecture</h4></a><a href="#Another Web Framework?"><h4>Another Web Framework?</h4></a><a href="#Technical Details"><h4>Technical Details</h4></a><a href="#Tutorial"><h3>Tutorial</h3></a><a href="#Installation"><h4>Installation</h4></a><a href="#Building &amp; Running"><h4>Building &amp; Running</h4></a><a href="#Defining Data Types"><h4>Defining Data Types</h4></a><a href="#Database Operations"><h4>Database Operations</h4></a><a href="#Telescopes Server"><h4>Telescope&#39;s Server</h4></a><a href="#Reflex-DOM Frontend"><h4>Reflex-DOM Frontend</h4></a><a href="#Server Integration"><h4>Server Integration</h4></a><a href="#Custom Handlers"><h4>Custom Handlers</h4></a><a href="#Authentication"><h4>Authentication</h4></a><a href="#Authorization"><h4>Authorization</h4></a><a href="#Nested Data Types"><h4>Nested Data Types</h4></a><a href="#Multiple Data Constructors"><h4>Multiple Data Constructors</h4></a><a href="#Avoiding Infinite Recursion"><h4>Avoiding Infinite Recursion</h4></a><a href="#Migrations"><h4>Migrations</h4></a><a href="#reflex-vty"><h4>reflex-vty</h4></a><a href="#FAQ"><h3>FAQ</h3></a><a href="#Why the Name Telescope?"><h4>Why the Name Telescope?</h4></a></div><div class="github"><a href="https://github.com/jerbaroo/telescope"><img src="GitHub_Logo.png" /></a></div></div><div class="content"><div><div align="center">
<h1><a name="Telescope">Telescope</a></h1>
<p><a href="https://github.com/jerbaroo/telescope/actions?query=workflow%3ATest"><img src="https://img.shields.io/github/workflow/status/jerbaroo/telescope/Test" alt="Build Status" /></a>
<a href="https://app.netlify.com/sites/telescope-hs/deploys"><img src="https://api.netlify.com/api/v1/badges/b42ff31b-1036-424b-8f24-419de5b62549/deploy-status" alt="Netlify Status" /></a>
<a href="https://telescope-hs.netlify.app"><img src="https://img.shields.io/badge/-documentation-5e5086" alt="Documentation" /></a>
<a href="https://github.com/jerbaroo/telescope"><img src="https://img.shields.io/github/stars/jerbaroo/telescope?style=social" alt="GitHub Stars" /></a></p>
</div>
<h2><a name="Introduction">Introduction</a></h2>
<p><em>Minimum viable product. Not production ready.</em></p>
<p>Telescope is a Haskell framework for building reactive applications. Apps built
with Telescope react to changes in your database, so they are always up-to-date.
The Telescope framework abstracts away some of the common tasks when developing
an application, <strong>allowing you to focus on your business logic</strong> and <strong>reducing
the time you need to build your reactive app!</strong></p>
<p>An application built with Telescope is..</p>
<ul>
<li><strong>Reactive:</strong> don&#39;t worry about keeping client-side and server-side data in
sync, your frontend can automatically react to changes in your database and
your database can be updated seamlessly by your frontend!</li>
<li><strong>Robust:</strong> writing the strongly-typed language Haskell across the stack
prevents server/client protocol mismatches and other run-time errors, allowing
you to move fast and not break things.</li>
<li><strong>Minimal:</strong> Telescope can setup a database and server for you and also manage
communication between client and server, so you can focus on the parts of your
application that really matter.</li>
</ul>
<p>What are Telescope&#39;s limitations?</p>
<ul>
<li>Telescope does not provide a full-featured database query language.</li>
<li>Telescope only supports a limited subset of Haskell data types.</li>
</ul>
<p>Telescope is particularly well-suited for applications where events are pushed
by the server e.g. notifications and dashboards. Telescope also handles forms
and input-validation very well. On the flip-side, applications with heavy
client-side computation such as animations are not well-suited for Telescope.</p>
<p>In short the way Telescope works: Telescope derives a schema for your data types
via <code>Generics</code>. Telescope exports functions F to manipulate data types in your
database. Telescope exports a server which acts as a proxy to the database for
any web clients, allowing web clients to execute the functions F as if they were
server-side. The <code>Telescope</code> typeclass determines how to communicate with a
database, Telescope is not specific to any one database (e.g. MongoDB) or
frontend library (e.g. Reflex-DOM). &quot;Reactive&quot; variants of the functions F are
provided, where function parameters and return values are streams of data (e.g.
<code>Event Int</code>) as opposed to single values (e.g. <code>Int</code>).</p>
<h2><a name="Getting Started">Getting Started</a></h2>
<p>To see what building a reactive application with Telescope looks like, we will
build a simple, yet functional, public chat room. Currently Telescope only has
support for <a href="https://reflex-frp.org/">Reflex-DOM</a> as a frontend, though support
for <a href="https://hackage.haskell.org/package/reflex-vty">reflex-vty</a> is planned.</p>
<p><strong>1.</strong> Define the data types used in your application.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Message</span> <span class="ot">=</span> <span class="dt">Message</span></span>
<span id="2"><a href="#2" tabindex="-1"></a>  {<span class="ot"> time     ::</span> <span class="dt">Int</span></span>
<span id="3"><a href="#3" tabindex="-1"></a>  ,<span class="ot"> room     ::</span> <span class="dt">Text</span></span>
<span id="4"><a href="#4" tabindex="-1"></a>  ,<span class="ot"> username ::</span> <span class="dt">Text</span></span>
<span id="5"><a href="#5" tabindex="-1"></a>  ,<span class="ot"> message  ::</span> <span class="dt">Text</span></span>
<span id="6"><a href="#6" tabindex="-1"></a>  } <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Ord</span>, <span class="dt">Generic</span>, <span class="dt">Show</span>)</span>
<span id="7"><a href="#7" tabindex="-1"></a></span>
<span id="8"><a href="#8" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">PrimaryKey</span> <span class="dt">Message</span> <span class="dt">Int</span> <span class="kw">where</span></span>
<span id="9"><a href="#9" tabindex="-1"></a>  primaryKey <span class="ot">=</span> time</span></code></pre></div>
<p><strong>2.</strong> Include Telescope&#39;s server in your backend code.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a>Server.run port <span class="fu">id</span></span></code></pre></div>
<p><strong>3.</strong> Write your frontend with <a href="https://reflex-frp.org/">Reflex-DOM</a>!</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a>main <span class="ot">=</span> mainWidget <span class="op">$</span> <span class="kw">do</span></span>
<span id="2"><a href="#2" tabindex="-1"></a>  <span class="co">-- A text field to enter chat room name and username.</span></span>
<span id="3"><a href="#3" tabindex="-1"></a>  (roomNameDyn, usernameDyn) <span class="ot">&lt;-</span> <span class="kw">do</span></span>
<span id="4"><a href="#4" tabindex="-1"></a>    roomNameInput <span class="ot">&lt;-</span> textInputPlaceholder <span class="st">&quot;Chat Room&quot;</span></span>
<span id="5"><a href="#5" tabindex="-1"></a>    usernameInput <span class="ot">&lt;-</span> textInputPlaceholder <span class="st">&quot;Username&quot;</span></span>
<span id="6"><a href="#6" tabindex="-1"></a>    <span class="fu">pure</span> (roomNameInput <span class="op">^.</span> textInput_value, usernameInput <span class="op">^.</span> textInput_value)</span>
<span id="7"><a href="#7" tabindex="-1"></a>  <span class="co">-- View messages live from the database.</span></span>
<span id="8"><a href="#8" tabindex="-1"></a>  dbMessagesEvn <span class="ot">&lt;-</span> T.viewTableRx <span class="op">$</span> <span class="fu">const</span> (<span class="dt">Proxy</span> <span class="op">@</span><span class="dt">Message</span>) <span class="op">&lt;$&gt;</span> updated roomNameDyn</span>
<span id="9"><a href="#9" tabindex="-1"></a>  <span class="co">-- Filter messages to the current chat room.</span></span>
<span id="10"><a href="#10" tabindex="-1"></a>  roomMessagesDyn <span class="ot">&lt;-</span> holdDyn [] <span class="op">$</span> attachPromptlyDynWith</span>
<span id="11"><a href="#11" tabindex="-1"></a>    (\rn ms <span class="ot">-&gt;</span> [m <span class="op">|</span> m <span class="ot">&lt;-</span> ms, room m <span class="op">==</span> rn]) roomNameDyn dbMessagesEvn</span>
<span id="12"><a href="#12" tabindex="-1"></a>  <span class="co">-- Display messages for the current chat room.</span></span>
<span id="13"><a href="#13" tabindex="-1"></a>  el <span class="st">&quot;ul&quot;</span> <span class="op">$</span> simpleList roomMessagesDyn <span class="op">$</span> el <span class="st">&quot;li&quot;</span> <span class="op">.</span> dynText <span class="op">.</span> <span class="fu">fmap</span></span>
<span id="14"><a href="#14" tabindex="-1"></a>    (\m <span class="ot">-&gt;</span> <span class="st">&quot;“&quot;</span> <span class="op">&lt;&gt;</span> username m <span class="op">&lt;&gt;</span> <span class="st">&quot;”: &quot;</span> <span class="op">&lt;&gt;</span> message m)</span>
<span id="15"><a href="#15" tabindex="-1"></a>  <span class="co">-- A text field for entering messages, and button to send the message.</span></span>
<span id="16"><a href="#16" tabindex="-1"></a>  messageTextDyn <span class="ot">&lt;-</span> (<span class="op">^.</span> textInput_value) <span class="op">&lt;$&gt;</span> textInputPlaceholder <span class="st">&quot;Enter Message&quot;</span></span>
<span id="17"><a href="#17" tabindex="-1"></a>  timeEvn        <span class="ot">&lt;-</span> <span class="fu">fmap</span> (<span class="fu">fmap</span> <span class="fu">round</span>) <span class="op">.</span> tagTime <span class="op">=&lt;&lt;</span> button <span class="st">&quot;Send&quot;</span></span>
<span id="18"><a href="#18" tabindex="-1"></a>  <span class="co">-- Construct a &#39;Message&#39; from user input, and send on button click.</span></span>
<span id="19"><a href="#19" tabindex="-1"></a>  <span class="kw">let</span> messageToSendDyn <span class="ot">=</span> (\room username message time <span class="ot">-&gt;</span> <span class="dt">Message</span> {<span class="op">..</span>})</span>
<span id="20"><a href="#20" tabindex="-1"></a>        <span class="op">&lt;$&gt;</span> roomNameDyn <span class="op">&lt;*&gt;</span> usernameDyn <span class="op">&lt;*&gt;</span> messageTextDyn</span>
<span id="21"><a href="#21" tabindex="-1"></a>      messageToSendEvn <span class="ot">=</span> attachPromptlyDynWith (<span class="op">$</span>) messageToSendDyn timeEvn</span>
<span id="22"><a href="#22" tabindex="-1"></a>  T.setRx messageToSendEvn</span></code></pre></div>
<p>Finally build and run the application. You can now open the app in two browser
tabs, interact with the app in one tab and watch the other app react!</p>
<p>A full tutorial is available <a href="https://telescope-hs.netlify.app/#Tutorial">here</a>.
In the tutorial we will develop a more full-featured version of this chat room
application that utilizes some additional features of the Telescope framework.</p>
<h2><a name="Contributing">Contributing</a></h2>
<p>Feedback, questions and contributions are all very welcome! The instructions
<a href="https://github.com/jerbaroo/telescope/blob/master/docs/DEVELOPMENT.md">here</a>
should contain all the commands you need to get started hacking on this project.
If you want to open an issue you can do that <a href="https://github.com/jerbaroo/telescope/issues/new">here</a>.</p>
<h1><a name="About Telescope">About Telescope</a></h1>
<h2><a name="Application Architecture">Application Architecture</a></h2>
<p>The most important component of Telescope from an application developer&#39;s
perspective is the Telescope interface, a set of functions that allow you to
read/write datatypes from/to a data source. This interface is available both
server-side and client-side. The diagram below shows one possible setup of a
Telescope application, each telescope icon represents usage of the Telescope
interface.</p>
<p>The bottom row of the diagram represents a developer interacting with a database
on their own machine. More specifically the developer has opened a REPL and is
using the Telescope interface to interact with the local database.</p>
<p>The top row of the diagram shows two uses of the Telescope interface, one by a
server, and one by a web client. The server is interacting with the database via
the Telescope interface and acts as a proxy to the database for any web clients.
The web client is communicating with the server via the Telescope interface, but
since the server is only acting as a proxy the client is really interacting with
the database.</p>
<div align="center">
  <img src="diagram/diagram.png" />
</div>
<p>There are a number of important points about the Telescope interface which we
will now discuss in turn, referring back to the architecture diagram above.</p>
<ul>
<li>Reactive variants of Telescope functions.</li>
<li>Multiple instances of the Telescope interface.</li>
<li>The Telescope interface is data source agnostic.</li>
<li>Data is uniquely determined by type and primary key.</li>
</ul>
<h2><a name="Another Web Framework?">Another Web Framework?</a></h2>
<p>There are many different web frameworks out there, and they all have pros and
cons. They pretty much all allow you to write reuseable components. Some can
ship a small file to the client, some allow you to write your server-side and
client-side code in the same language, some can pre-render server-side for a
speedy TTI (time to interactive).</p>
<p>One idea that has become fairly popular in recent years is that of a reactive
frontend. Whereby the frontend is written as a function of the current state,
and whenever the state changes, the frontend &quot;reacts&quot; to the change and updates
itself.</p>
<p>Implementations of reactive frontends vary, however in the vast majority of
cases one significant limitation is that the frontend only reacts to client-side
changes in data. At this network boundary the developer still has to manage
communication with a server.</p>
<p>The primary motivation behind creating Telescope is that a developer should be
able to <strong>write a reactive frontend as a function of data in their one true data
source</strong>. Telescope solves this by providing a direct Reflex-DOM &lt;-&gt; database
link. Even better, the Telescope interface is not specific to Reflex-DOM or the
database. You could write an instance to use in e.g. a <code>reflex-vty</code> application,
or to communicate with a different server or database.</p>
<h2><a name="Technical Details">Technical Details</a></h2>
<p>So Telescope is a web framework? More generally Telescope provides a reactive
interface (the <code>Telescope</code> typeclass) to read/write datatypes from/to a data
source. The data source&#39;s location (e.g. filepath or URL) is a parameter of the
interface, allowing you to use the same interface to read/write data regardless
of where that data is stored. Even better, you can use the Telescope interface
both server-side and client-side. The use of the term &quot;reactive&quot; in &quot;reactive
interface&quot; refers to the fact that clients can subscribe to changes in data,
reacting to any changes.</p>
<p>The <code>telescope</code> package provides the Telescope interface without any instances.
The <code>telescope-ds-file</code> package provides an instance of the interface, that
stores data in local files. The <code>telescope-ds-reflex-dom</code> package provides an
instance of the interface to be used in a <a href="https://reflex-frp.org/">Reflex-DOM</a>
web app, it talks to a server to read/write data. The <code>telescope-server</code> package
provides a <a href="https://www.servant.dev/">Servant</a> server that serves data via a
provided instance of the Telescope interface e.g. from <code>telescope-ds-file</code>.</p>
<p>The Telescope interface provides functions that operate on datatypes which are
instances of the <code>Entity</code> typeclass. You only need to define a primary key for
your datatype and then the <code>Entity</code> instance can be derived for your datatype
via <code>Generics</code>. Generic programming allows conversion of your datatype to/from
storable representation. The following diagram shows this conversion.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a><span class="co">-- Example of a datatype to be stored.</span></span>
<span id="2"><a href="#2" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Person</span> {<span class="ot"> name ::</span> <span class="dt">Text</span>,<span class="ot"> age  ::</span> <span class="dt">Int</span> } <span class="kw">deriving</span> <span class="dt">Generic</span></span>
<span id="3"><a href="#3" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">PrimaryKey</span> <span class="dt">Person</span> <span class="kw">where</span> primaryKey <span class="ot">=</span> name</span>
<span id="4"><a href="#4" tabindex="-1"></a>  </span>
<span id="5"><a href="#5" tabindex="-1"></a><span class="co">-- Diagram showing conversion to/from storable representation.</span></span>
<span id="6"><a href="#6" tabindex="-1"></a><span class="dt">Person</span> <span class="st">&quot;john&quot;</span> <span class="dv">70</span>     <span class="op">&lt;---&gt;</span>     <span class="st">&quot;Person&quot;</span></span>
<span id="7"><a href="#7" tabindex="-1"></a>                               <span class="op">|</span> <span class="dt">ID</span>     <span class="op">|</span> <span class="st">&quot;name&quot;</span> <span class="op">|</span> <span class="st">&quot;age&quot;</span> <span class="op">|</span></span>
<span id="8"><a href="#8" tabindex="-1"></a>                               <span class="op">|</span> <span class="st">&quot;john&quot;</span> <span class="op">|</span> <span class="st">&quot;john&quot;</span> <span class="op">|</span> <span class="dv">70</span>    <span class="op">|</span></span></code></pre></div>
<h1><a name="Tutorial">Tutorial</a></h1>
<p>In this tutorial we will walk through some of the features that Telescope
provides. The first few features will be presented as if we were building a
simple chat room application. Note that this is not a tutorial on Reflex. If you
are new to Reflex you may find some of the following links helpful:</p>
<ul>
<li><a href="https://github.com/reflex-frp/reflex-platform/blob/develop/README.md#tutorial">Reflex-DOM Calculator Tutorial</a></li>
<li><a href="https://github.com/reflex-frp/reflex-platform/blob/develop/docs/project-development.rst">Reflex Project Development</a></li>
<li><a href="https://github.com/reflex-frp/reflex/blob/develop/Quickref.md">Reflex Quick Reference</a></li>
<li><a href="https://github.com/reflex-frp/reflex-dom/blob/develop/Quickref.md">Reflex-DOM Quick Reference</a></li>
</ul>
<h2><a name="Installation">Installation</a></h2>
<p>First install <a href="https://nixos.org/download.html">Nix</a> the package manager, and
install <a href="https://docs.cachix.org/">Cachix</a> to make use of our binary cache. Then
clone this repo (with submodules) and change in to the <code>telescope</code> directory.
You will also want to configure use of the Reflex-FRP cache, follow step 2
<a href="https://github.com/obsidiansystems/obelisk#installing-obelisk">here</a>. Finally
download pre-built binaries with Cachix, and perform an initial build:</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a><span class="ex">curl</span> -L https://nixos.org/nix/install <span class="kw">|</span> <span class="fu">sh</span></span>
<span id="2"><a href="#2" tabindex="-1"></a><span class="ex">nix-env</span> -iA cachix -f https://cachix.org/api/v1/install</span>
<span id="3"><a href="#3" tabindex="-1"></a><span class="fu">git</span> clone --recurse-submodules https://github.com/jerbaroo/telescope</span>
<span id="4"><a href="#4" tabindex="-1"></a><span class="bu">cd</span> telescope</span>
<span id="5"><a href="#5" tabindex="-1"></a><span class="ex">./scripts/cachix/use.sh</span> <span class="co"># Will take a long time the first time.</span></span></code></pre></div>
<h2><a name="Building &amp; Running">Building &amp; Running</a></h2>
<p>The Telescope repo provides example projects which you can build or browse the
source code of. One of these is a /very/ simple chat room web application. To
build and run the chat room application execute the commands below. These two
commands will start a development server each, the first builds and runs your
app&#39;s backend server, reloading everytime the source code changes. And the
second builds and runs a server that serves your frontend, reloading everytime
the source code changes. Visit <code>localhost:3003</code> to see the app in your browser.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a><span class="ex">./scripts/run/dev.sh</span> chatroom-backend</span>
<span id="2"><a href="#2" tabindex="-1"></a><span class="ex">./scripts/run/dev.sh</span> chatroom-frontend</span></code></pre></div>
<p>When you are ready to run the application in production you can run the commands
below. These commands will build your frontend files (HTML and JavaScript), and
build and run your backend server. Visit <code>localhost:3002</code> to see the app in your
browser.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a><span class="ex">./scripts/build/prod.sh</span> chatroom-frontend</span>
<span id="2"><a href="#2" tabindex="-1"></a><span class="ex">./scripts/build/prod.sh</span> chatroom-backend</span>
<span id="3"><a href="#3" tabindex="-1"></a><span class="ex">./scripts/run/prod.sh</span>   chatroom-backend</span></code></pre></div>
<h2><a name="Defining Data Types">Defining Data Types</a></h2>
<p>Telescope applications are primarily built as functions of data that is stored
in a database. Therefore we need to define data types that model our application
while keeping in mind that the data will be stored in a database. A simple
method of storing our data is to store each chat room message as a row in a
database along with any information associated with the message, such as: time
the message was sent, who sent the message, and what chat room the message was
sent in. The data type below captures these requirements. Each field of the data
type will be stored in one column of a table <code>&quot;Message&quot;</code> in the database. The
following code which defines the <code>Message</code> data type for our chat room app is
available in <code>telescope/apps/chatroom-common/src/ChatRoom/Common.hs</code>.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Message</span> <span class="ot">=</span> <span class="dt">Message</span></span>
<span id="2"><a href="#2" tabindex="-1"></a>  {<span class="ot"> time     ::</span> <span class="dt">Int</span></span>
<span id="3"><a href="#3" tabindex="-1"></a>  ,<span class="ot"> room     ::</span> <span class="dt">Text</span></span>
<span id="4"><a href="#4" tabindex="-1"></a>  ,<span class="ot"> username ::</span> <span class="dt">Text</span></span>
<span id="5"><a href="#5" tabindex="-1"></a>  ,<span class="ot"> message  ::</span> <span class="dt">Text</span></span>
<span id="6"><a href="#6" tabindex="-1"></a>  } <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Ord</span>, <span class="dt">Generic</span>, <span class="dt">Show</span>)</span>
<span id="7"><a href="#7" tabindex="-1"></a></span>
<span id="8"><a href="#8" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">PrimaryKey</span> <span class="dt">Message</span> <span class="dt">Int</span> <span class="kw">where</span></span>
<span id="9"><a href="#9" tabindex="-1"></a>  primaryKey <span class="ot">=</span> time</span></code></pre></div>
<h2><a name="Database Operations">Database Operations</a></h2>
<p>During development you might want to insert some data into your database for
testing. Or when running in production you might want to perform some database
maintenance. Telescope provides a number of operations for interacting with your
database, these operations are available both server-side and client-side. These
operations are available in the <code>Telescope.Operations</code> module. The following
backend code is available in <code>telescope/apps/chatroom-backend/app/Main.hs</code>.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="2"><a href="#2" tabindex="-1"></a>  <span class="kw">let</span> msg <span class="ot">=</span> <span class="dt">Message</span> <span class="dv">1</span> <span class="st">&quot;main&quot;</span> <span class="st">&quot;john&quot;</span> <span class="st">&quot;Hello everyone&quot;</span></span>
<span id="3"><a href="#3" tabindex="-1"></a>  <span class="co">-- You might find the following pattern useful in development. Running this</span></span>
<span id="4"><a href="#4" tabindex="-1"></a>  <span class="co">-- code before the server starts will remove all messages and insert &#39;msg&#39;.</span></span>
<span id="5"><a href="#5" tabindex="-1"></a>  runT <span class="op">$</span> T.rmTable <span class="op">@</span><span class="dt">Message</span> <span class="op">&gt;&gt;</span> T.set msg</span>
<span id="6"><a href="#6" tabindex="-1"></a>  <span class="co">-- ...</span></span></code></pre></div>
<h2><a name="Telescopes Server">Telescope&#39;s Server</a></h2>
<p>Telescope exports a server which understands data types that are an instance of
the <code>Entity</code> typeclass, such as the <code>Message</code> data type defined above for our
chat room example. When using Telescope operations client-side, the data types
are decomposed into storable representation and sent to the server, which then
completes the operation server-side. Running an instance of Telescope&#39;s server
is super simple. The following backend code to start a server is available in
<code>telescope/apps/chatroom-backend/app/Main.hs</code>.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="2"><a href="#2" tabindex="-1"></a>  <span class="co">-- ...</span></span>
<span id="3"><a href="#3" tabindex="-1"></a>  Server.run <span class="dv">3002</span> Server.developmentCors</span></code></pre></div>
<h2><a name="Reflex-DOM Frontend">Reflex-DOM Frontend</a></h2>
<p>To complete our chat room application, we just need a frontend. The Telescope
interface is not specific to any frontend, however Telescope currently only
provides integrations with Reflex-DOM. In our chat room frontend we will <code>view</code>
messages live from the database, and anytime the user presses enter we will
<code>set</code> their message into the database. As previously mentioned this is not a
tutorial on Reflex-DOM, so we won&#39;t be discussing the whole frontend. You can
find this frontend code in <code>telescope/apps/chatroom-frontend/app/Main.hs</code>.</p>
<p>Notice the use of the functions <code>T.viewTableRx</code> and <code>T.setRx</code> in the code below.
These Telescope operations will respectively, &quot;view&quot; an entire table live from
the database, and set a stream of data into the database.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a>main <span class="ot">=</span> mainWidget <span class="op">$</span> <span class="kw">do</span></span>
<span id="2"><a href="#2" tabindex="-1"></a>  <span class="co">-- A text field to enter chat room name and username.</span></span>
<span id="3"><a href="#3" tabindex="-1"></a>  (roomNameDyn, usernameDyn) <span class="ot">&lt;-</span> <span class="kw">do</span></span>
<span id="4"><a href="#4" tabindex="-1"></a>    roomNameInput <span class="ot">&lt;-</span> textInputPlaceholder <span class="st">&quot;Chat Room&quot;</span></span>
<span id="5"><a href="#5" tabindex="-1"></a>    usernameInput <span class="ot">&lt;-</span> textInputPlaceholder <span class="st">&quot;Username&quot;</span></span>
<span id="6"><a href="#6" tabindex="-1"></a>    <span class="fu">pure</span> (roomNameInput <span class="op">^.</span> textInput_value, usernameInput <span class="op">^.</span> textInput_value)</span>
<span id="7"><a href="#7" tabindex="-1"></a>  <span class="co">-- View messages live from the database.</span></span>
<span id="8"><a href="#8" tabindex="-1"></a>  dbMessagesEvn <span class="ot">&lt;-</span> T.viewTableRx <span class="op">$</span> <span class="fu">const</span> (<span class="dt">Proxy</span> <span class="op">@</span><span class="dt">Message</span>) <span class="op">&lt;$&gt;</span> updated roomNameDyn</span>
<span id="9"><a href="#9" tabindex="-1"></a>  <span class="co">-- Filter messages to the current chat room.</span></span>
<span id="10"><a href="#10" tabindex="-1"></a>  roomMessagesDyn <span class="ot">&lt;-</span> holdDyn [] <span class="op">$</span> attachPromptlyDynWith</span>
<span id="11"><a href="#11" tabindex="-1"></a>    (\rn ms <span class="ot">-&gt;</span> [m <span class="op">|</span> m <span class="ot">&lt;-</span> ms, room m <span class="op">==</span> rn]) roomNameDyn dbMessagesEvn</span>
<span id="12"><a href="#12" tabindex="-1"></a>  <span class="co">-- Display messages for the current chat room.</span></span>
<span id="13"><a href="#13" tabindex="-1"></a>  el <span class="st">&quot;ul&quot;</span> <span class="op">$</span> simpleList roomMessagesDyn <span class="op">$</span> el <span class="st">&quot;li&quot;</span> <span class="op">.</span> dynText <span class="op">.</span> <span class="fu">fmap</span></span>
<span id="14"><a href="#14" tabindex="-1"></a>    (\m <span class="ot">-&gt;</span> <span class="st">&quot;“&quot;</span> <span class="op">&lt;&gt;</span> username m <span class="op">&lt;&gt;</span> <span class="st">&quot;”: &quot;</span> <span class="op">&lt;&gt;</span> message m)</span>
<span id="15"><a href="#15" tabindex="-1"></a>  <span class="co">-- A text field for entering messages, and button to send the message.</span></span>
<span id="16"><a href="#16" tabindex="-1"></a>  messageTextDyn <span class="ot">&lt;-</span> (<span class="op">^.</span> textInput_value) <span class="op">&lt;$&gt;</span> textInputPlaceholder <span class="st">&quot;Enter Message&quot;</span></span>
<span id="17"><a href="#17" tabindex="-1"></a>  timeEvn        <span class="ot">&lt;-</span> <span class="fu">fmap</span> (<span class="fu">fmap</span> <span class="fu">round</span>) <span class="op">.</span> tagTime <span class="op">=&lt;&lt;</span> button <span class="st">&quot;Send&quot;</span></span>
<span id="18"><a href="#18" tabindex="-1"></a>  <span class="co">-- Construct a &#39;Message&#39; from user input, and send on button click.</span></span>
<span id="19"><a href="#19" tabindex="-1"></a>  <span class="kw">let</span> messageToSendDyn <span class="ot">=</span> (\room username message time <span class="ot">-&gt;</span> <span class="dt">Message</span> {<span class="op">..</span>})</span>
<span id="20"><a href="#20" tabindex="-1"></a>        <span class="op">&lt;$&gt;</span> roomNameDyn <span class="op">&lt;*&gt;</span> usernameDyn <span class="op">&lt;*&gt;</span> messageTextDyn</span>
<span id="21"><a href="#21" tabindex="-1"></a>      messageToSendEvn <span class="ot">=</span> attachPromptlyDynWith (<span class="op">$</span>) messageToSendDyn timeEvn</span>
<span id="22"><a href="#22" tabindex="-1"></a>  T.setRx messageToSendEvn</span></code></pre></div>
<h2><a name="Server Integration">Server Integration</a></h2>
<p>Telescope is useful when you have data that is uniquely determined by a primary
key, Telescope helps you store that data in a database and manipulate/access
that data. However it may be the case that you don&#39;t want to use Telescope to
develop part of your server&#39;s API, perhaps you already have a server that you
don&#39;t want to rewrite, perhaps you have data that you want to serve but not
store in a database, or perhaps you simply prefer another solution to develop
part of your API.</p>
<p>The server that Telescope exports is part of the Servant package (<a href="https://hackage.haskell.org/package/servant-server-0.18.2/docs/Servant-Server.html#t:Server">Hackage
link</a>).
If your additional server is a Servant <code>Server</code> it can very easily be combined
with Telescope&#39;s server, see the code below. On the other hand if your existing
server is not a Servant <code>Server</code> then you have two options. One option is to
expose both servers to the client. The second option is to setup your server to
proxy all requests intended for Telescope to Telescope&#39;s server. The following
code integrating an existing <code>Server</code> with Telescope&#39;s <code>Server</code> is available in
<code>telescope/apps/chatroom-backend/app/Main.hs</code>. The frontend code that interacts
with the integrated server is in <code>telescope/apps/chatroom-frontend/app/Main.hs</code>.</p>
<div class="sourceCode"><pre class="sourceCode"><code class="sourceCode"><span id="1"><a href="#1" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="2"><a href="#2" tabindex="-1"></a>  <span class="co">-- ...</span></span>
<span id="3"><a href="#3" tabindex="-1"></a>  Warp.run <span class="dv">3002</span> <span class="op">$</span> Server.developmentCors <span class="op">$</span></span>
<span id="4"><a href="#4" tabindex="-1"></a>    Servant.serve (<span class="dt">Proxy</span><span class="ot"> ::</span> <span class="dt">Proxy</span> <span class="dt">API</span>) (additionalServer <span class="op">:&lt;|&gt;</span> Server.server)</span>
<span id="5"><a href="#5" tabindex="-1"></a></span>
<span id="6"><a href="#6" tabindex="-1"></a><span class="co">-- | Additional server with only one endpoint, for demonstrative purposes.</span></span>
<span id="7"><a href="#7" tabindex="-1"></a><span class="ot">additionalServer ::</span> <span class="dt">Servant.Server</span> <span class="dt">AdditionalAPI</span></span>
<span id="8"><a href="#8" tabindex="-1"></a>additionalServer <span class="ot">=</span> <span class="fu">pure</span> <span class="st">&quot;This is data returned by the additional server&quot;</span></span>
<span id="9"><a href="#9" tabindex="-1"></a></span>
<span id="10"><a href="#10" tabindex="-1"></a><span class="kw">type</span> <span class="dt">AdditionalAPI</span> <span class="ot">=</span> <span class="st">&quot;additional&quot;</span> <span class="op">:&gt;</span> <span class="dt">Get</span> <span class="ch">&#39;[JSON] Text</span></span>
<span id="11"><a href="#11" tabindex="-1"></a><span class="kw">type</span> <span class="dt">API</span> <span class="ot">=</span> <span class="dt">AdditionalAPI</span> <span class="op">:&lt;|&gt;</span> <span class="dt">Telescope.API</span></span></code></pre></div>
<h2><a name="Custom Handlers">Custom Handlers</a></h2>
<h2><a name="Authentication">Authentication</a></h2>
<h2><a name="Authorization">Authorization</a></h2>
<h2><a name="Nested Data Types">Nested Data Types</a></h2>
<h2><a name="Multiple Data Constructors">Multiple Data Constructors</a></h2>
<h2><a name="Avoiding Infinite Recursion">Avoiding Infinite Recursion</a></h2>
<h2><a name="Migrations">Migrations</a></h2>
<h2><a name="reflex-vty">reflex-vty</a></h2>
<h1><a name="FAQ">FAQ</a></h1>
<h2><a name="Why the Name Telescope?">Why the Name Telescope?</a></h2>
<p>The <code>telescope</code> package provides an interface to read/write remote data i.e.
data stored in a database or data accessed over the network. This interface is
&quot;lens-like&quot; i.e. the functions are similar to the functions <code>view</code>, <code>set</code> etc.
that you may know from the <code>lens</code> library. So if you squint your eyes a little
you could say this library provides a lens to look at remote data... like a
telescope.</p>
</div></div></body>